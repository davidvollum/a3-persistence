<!doctype html>
<html lang="en">
  <head>
    <title>CS4241 Assignment 2</title>
    <meta charset="utf-8">
  </head>
  <body>
      <table id = "results">
          <thead>
              <tr>
                  <th colspan="4">Comments</th>
              </tr>
          </thead>
          <tbody id = "tableBody">
              <tr>
                  <td>Please Press refresh to see results</td>
              </tr>
          </tbody>
      </table>
      <button id = "refresh">refresh</button>
      <br>
      <h3>The clear button will clear the comments stored on the server</h3>
      <button id = "clear">clear</button>


      <form action="">
            <input type="text" id="name" value="Name">
            <input type="text" id="email" value="email">
            <input type="text" id="comment" value="comment">
            <button id = 'submit'>submit</button>
        </form>

  </body>
  <script>
    function addNewEntry(username, comment){
      let tableRef = document.getElementById("results");
      let newRow = tableRef.insertRow(-1)
      let usernameText = document.createTextNode(username);
      let commentText = document.createTextNode(comment);
      let userNameCell = newRow.insertCell(0)
      let commentCell = newRow.insertCell(1)
      userNameCell.appendChild(usernameText)
      commentCell.appendChild(commentText)
    }

const submit = function( e ){
    e.preventDefault()
    const comment = document.querySelector("#comment").value
    console.log(comment)
    fetch('/newComment',  {
                method: 'POST',
                body: JSON.stringify({comment}),
                headers: { 'Content-Type': 'application/json' }
            }).then(res => {
                res.json()
            .then(res => {
                console.log("username: "+res.status)
                addNewEntry(res['username'], comment)
            })
        })
    }
    
    function getComments(){
        fetch('/getComments',  {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' }
        }).then(res => {
            console.log(res)
            res.json()
            .then(res => {
                let i = 0
                for (i = 0; i < res.length; i++){
                    addNewEntry(res[i].username, res[i].comment)
                }
            })
        })
        
    }
        


  window.onload = function() {
    getComments()
    const submitButton = document.getElementById( 'submit' )
    submitButton.onclick = submit
  }

  </script>
</html>
